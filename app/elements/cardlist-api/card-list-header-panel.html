<dom-module id="card-list-header-panel">
  <style>
    :host {
      display: block;
    }

    paper-scroll-header-panel {
      height: 100%;
    }

    .container {
      display: flex;
      justify-content: space-between;
      flex-direction: column;
      height: 100%;
    }

    .assignments-title {
      width: 100%;
    }

    .assignments-title > div {
      display: inline;
    }

    paper-scroll-header-panel {
      height: 100%;
    }

    .refresh-button {
      float: right;
    }

    .buttons {
      width: 100%;
    }

    .cardlist-container {
      flex: 1;
      overflow-y: scroll;
    }

    paper-button {
      --paper-button-flat-keyboard-focus: {
        font-weight: normal;
      }
    }
  </style>
  <template>
    <paper-scroll-header-panel fixed>
      <paper-toolbar class="flex">
        <div class="assignments-title paper-font-title">Assignments</div>
        <div class="buttons">
          <paper-icon-button icon="refresh" class="refresh-button" on-tap="refresh"></paper-icon-button>
          <paper-button on-tap="switch">{{status}}</paper-icon-button>
        </div>
      </paper-toolbar>
      <div class="container">
        <div class="cardlist-container">
          <cardslist-api
            id="unplanned"
            hidden$="{{createView}}"
            name="Unplanned"
            user="{{user}}"
            apiurl="courses/assignments">
          </cardslist-api>
          <card-assignment-create-panel on-create="addAssignment" on-uploaded="fireRefreshed" hidden$="{{!createView}}"></card-assignment-create-panel>
        </div>
        <card-chart id="chart"></card-chart>
      </div>
    </paper-scroll-header-panel>
  </template>
  <script>
    Polymer({
      is: 'card-list-header-panel',

      properties: {
        user: {
          type: Object
        }
      },

      ready: function() {
        this.createView = false;
        this.status = "Create";
      },

      refresh: function() {
        this.$.unplanned.reloadList();
        this.refreshChart();
      },

      refreshChart: function() {
        this.$.chart.reloadStats();
      },

      addAssignment: function(event) {
        this.switch();
        this.$.unplanned.addAssignment(event.detail.assignment);
      },

      switch: function() {
        this.createView = !this.createView;
        this.status = this.createView ? "List" : "Create";
      },

      fireRefreshed: function() {
        this.fire('refresh');
      }
    });
  </script>
</dom-module>
